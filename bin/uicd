#!/usr/bin/perl
# Copyright (c) 2012, Mitchell Cooper

use warnings;
use strict;

local ($0,     $SIG{TERM},        $SIG{KILL},        $SIG{PIPE}        ) =
      ('uicd', \&UICd::terminate, \&UICd::terminate, \&UICd::signalpipe);
local ($SIG{HUP},         $SIG{__WARN__}                               ) =
      (\&UICd::signalhup, \&UICd::WARNING                              );

our ($run_dir, $loop);

BEGIN {

    # find the directory to run from.
    if ( not defined ($run_dir = shift @ARGV) ) {
        die "No directory specified.\n";
    }

    # make sure the run directory exists.
    if (!-d $run_dir) {
        die "Run directory does not exist.\n";
    }

    chdir $run_dir or die "Can't access run directory.\n";
    unshift @INC, "$run_dir/inc";

    require UICd;
    UICd::begin();
}

UICd::boot();
UICd::loop();
